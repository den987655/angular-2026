# TgLab Demo — Инструкция

## Установка зависимостей

```bash
npm install
```

## Запуск

1. **API (бэкенд):**
   ```bash
   npx nx serve api
   ```
   Работает на http://localhost:3000/api

2. **Фронтенд:**
   ```bash
   npx nx serve web
   ```
   Работает на http://localhost:4200

## Регистрация и вход

1. Перейдите на http://localhost:4200/signup
2. Введите email и пароль, нажмите «Зарегистрироваться»
3. **Без SMTP:** ссылка подтверждения выводится в консоль API (терминал, где запущен `nx serve api`). Скопируйте ссылку и откройте в браузере.
4. **С SMTP:** задайте переменные `SMTP_HOST`, `SMTP_USER`, `SMTP_PASS` — письмо придёт на указанный email
5. После подтверждения перейдите на /signin и войдите
6. После входа откроется дашборд /dashboard

## Профиль

- В боковой панели нажмите иконку профиля → смена пароля, выход
- Выход очищает JWT из localStorage и перенаправляет на главную

## Переменные окружения (API)

- `JWT_SECRET` — секрет для JWT (по умолчанию demo-секрет)
- `FRONTEND_URL` — URL фронта для ссылок в письмах (по умолчанию http://localhost:4200)
- `SMTP_HOST`, `SMTP_USER`, `SMTP_PASS`, `SMTP_PORT`, `SMTP_FROM` — настройки почты

## Миграции TypeORM (PostgreSQL)

В продакшене `synchronize` отключен, потому что он может неожиданно изменить/удалить таблицы.
Для надёжных и повторяемых изменений схемы используются миграции.

Команды (в корне `tg-lab`):

```bash
# генерация миграции (обязательно указать путь)
npm run migration:generate -- apps/api/src/migrations/InitSchema

# применить все миграции
npm run migration:run

# откатить последнюю миграцию
npm run migration:revert
```

Важно: CLI берёт настройки БД из переменных окружения (`DB_HOST`, `DB_PORT`, `DB_USER`, `DB_PASS`, `DB_NAME`).
Если они не подхватываются автоматически, экспортируйте их перед запуском команд.
